{% extends 'base.html.twig' %}

{% block title %}Arbre Vivant â€” Nous Autres{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('styles.css') }}">
{% endblock %}

{% block body %}
<div class="page-arbre">
    <h1>ðŸŒ³ Lâ€™Arbre Vivant</h1>
    <p>
        Une visualisation organique des cercles, racines et engagements du mouvement <strong>Nous Autres</strong>.
        Ici sâ€™esquisse la structure vivante dâ€™une conscience en germination.
    </p>

    <canvas id="treeCanvas" width="800" height="600"></canvas>

    <a href="/cercles" class="arbre-btn">Explorer les cercles</a>
</div>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('js/arbre.js') }}" defer>
        document.addEventListener('DOMContentLoaded', () => {
            startTree();
        });
    </script>
    <script>
        fetch('/api/cercle')
        .then(response => response.json())
        .then(data => {
            console.log('Cercles reÃ§us :', data);
            // âžœ ici, tu insÃ©reras les cercles dans ton arbre fractal
        });
    </script>
    <script>
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/api/cercle")
      .then(response => response.json())
      .then(data => {
        const cercles = data['hydra:member'];
        const container = document.getElementById("cercles-container");

        if (cercles.length === 0) {
          container.innerHTML = "<p>Aucun cercle pour le moment.</p>";
        } else {
          cercles.forEach(cercle => {
            const div = document.createElement("div");
            div.className = "cercle";
            div.innerHTML = `<strong>${cercle.nom}</strong> (${cercle.type})<br>${cercle.description || ""}`;
            container.appendChild(div);
          });
        }
      })
      .catch(error => {
        console.error("Erreur lors du chargement des cercles :", error);
      });
  });
</script>

{% endblock %}